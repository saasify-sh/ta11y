<p align="center">
  <a href="https://ta11y.saasify.sh" title="ta11y">
    <img src="https://raw.githubusercontent.com/saasify-sh/ta11y/master/media/logo.svg?sanitize=true" alt="ta11y Logo" width="256" />
  </a>
</p>

# @ta11y/core

> Core library for running web accessibility audits with ta11y.

[![NPM](https://img.shields.io/npm/v/@ta11y/core.svg)](https://www.npmjs.com/package/@ta11y/core) [![Build Status](https://travis-ci.com/saasify-sh/ta11y.svg?branch=master)](https://travis-ci.com/saasify-sh/ta11y) [![JavaScript Style Guide](https://img.shields.io/badge/code_style-standard-brightgreen.svg)](https://standardjs.com)

## Install

```bash
npm install --save @ta11y/core
```

## Usage

```js
const { Ta11y } = require('@ta11y/core')

const ta11y = new Ta11y()

ta11y.audit('https://en.wikipedia.org')
  .then((results) => {
    console.log(JSON.stringify(results, null, 2))
  })
```

Alternatively, you can tell ta11y to **crawl** additional pages starting from the root page.

```js
ta11y.audit('https://en.wikipedia.org', {
  crawl: true,
  maxDepth: 1,
  maxVisit: 64
})
```

If you want to crawl non-public pages, pass an instance of [Puppeteer](https://pptr.dev). This is useful for testing in development or behind corporate firewalls.

```js
const puppeteer = require('puppeteer')

const browser = await puppeteer.launch()

ta11y.audit('http://localhost:3000', {
  browser,
  crawl: true,
  maxDepth: 0
})
```

You can also pass HTML directly to audit (whole pages or fragments).

```js
ta11y.audit('<!doctype><html><body><h1>I ❤ accessibility</h1></body></html>')
```

### API Key

The free tier is subject to rate limits as well as a 60 second timeout, so if you're crawling a larger site, you're better off running content extraction locally.

If you're processing a non-publicly accessible website (like `localhost`), then you _must_ perform content extraction locally.

You can bypass rate limiting by [signing up](https://ta11y.saasify.sh/pricing) for an API key and passing it either via the `apiKey` option of the `Ta11y` constructor or via the `TA11Y_API_KEY` environment variable.

```js
const ta11y = new Ta11y({
  apiKey: '<your-api-key>'
})
```

Visit [ta11y](https://ta11y.saasify.sh) once you're ready to sign up for an API key.

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### [Ta11y](https://git@github.com/:saasify-sh/ta11y/blob/be939fdf23bcfe0c2f401eea0868805afa220472/packages/ta11y-core/lib/index.js#L27-L192)

Class to run web accessibility audits via the [ta11y API](https://ta11y.saasify.sh).

Type: `function (opts)`

-   `opts` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)?** Config options.
    -   `opts.apiKey` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** Optional ta11y API key which disables rate limits.
    -   `opts.apiBaseUrl` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Optional custom Ta11y deployment which is useful for on-premise scenarios. (optional, default `'https://ssfy.sh/dev/ta11y'`)

### [audit](https://git@github.com/:saasify-sh/ta11y/blob/be939fdf23bcfe0c2f401eea0868805afa220472/packages/ta11y-core/lib/index.js#L84-L101)

Runs an accessibility audit against the given URL or raw HTML, optionally crawling the
site to discover additional pages and auditing those too.

To audit local or private websites, pass an instance of Puppeteer as `opts.browser`.

The default behavior is to perform content extraction and auditing remotely. This works
best for auditing publicly accessible websites.

Type: `function (urlOrHtml, opts): Promise`

-   `urlOrHtml` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** URL or raw HTML to process.
-   `opts` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Config options.
    -   `opts.suites` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>?** Optional array of audit suites to run. Possible values:-   `section508`
        -   `wcag2a`
        -   `wcag2aa`
        -   `wcag2aaa`
        -   `best-practice`
        -   `html`Defaults to running all audit suites.
    -   `opts.browser` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)?** Optional [Puppeteer](https://pptr.dev) browser instance to use for auditing websites that aren't publicly reachable.
    -   `opts.extractOnly` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** Whether or not to perform extraction and auditing, or just extraction. By default, a full audit is performed, but in some cases it can be useful to store the extraction results for later processing. (optional, default `false`)
    -   `opts.crawl` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** Whether or not to crawl additional pages. (optional, default `false`)
    -   `opts.maxDepth` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Maximum crawl depth while crawling. (optional, default `16`)
    -   `opts.maxVisit` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Maximum number of pages to visit while crawling.
    -   `opts.sameOrigin` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** Whether or not to only consider crawling links with the same origin as the root URL. (optional, default `true`)
    -   `opts.blacklist` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>?** Optional blacklist of URL [glob patterns](https://github.com/micromatch/micromatch) to ignore.
    -   `opts.whitelist` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>?** Optional whitelist of URL [glob patterns](https://github.com/micromatch/micromatch) to only include.
    -   `opts.gotoOptions` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)?** Customize the `Page.goto` navigation options.
    -   `opts.viewport` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)?** Set the browser window's viewport dimensions and/or resolution.
    -   `opts.userAgent` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** Set the browser's [user-agent](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent).
    -   `opts.emulateDevice` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** Emulate a specific device type.-   Use the `name` property from one of the built-in [devices](https://github.com/GoogleChrome/puppeteer/blob/master/lib/DeviceDescriptors.js).
        -   Overrides `viewport` and `userAgent`.
    -   `opts.onNewPage` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)?** Optional async function called every time a new page is
        initialized before proceeding with extraction.

### [auditExtractResults](https://git@github.com/:saasify-sh/ta11y/blob/be939fdf23bcfe0c2f401eea0868805afa220472/packages/ta11y-core/lib/index.js#L121-L146)

Runs an accessibility audit against previously collected extraction results from
`@ta11y/extract`.

Type: `function (extractResults, opts): Promise`

-   `extractResults` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Extraction results conforming to the output format
    from `@ta11y/extract`.
-   `opts` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Config options. (optional, default `{}`)
    -   `opts.suites` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>?** Optional array of audit suites to run. Possible values:-   `section508`
        -   `wcag2a`
        -   `wcag2aa`
        -   `wcag2aaa`
        -   `best-practice`
        -   `html`Defaults to running all audits suites.

## License

MIT © [Saasify](https://saasify.sh)
